---
- name: Configure OCP 4 cluster
  hosts: localhost
  connection: local
  module_defaults:
    group/kubernetes.core.k8s:
      host: "{{ api_entrypoint }}"
      ca_cert: "{{ api_ca_cert }}"
  tasks:
    - name: Load user credentials for OCP
      include_vars: 
        file: group_vars/user_credentials.vault
      no_log: true
    - name: Install GitOps operator
      include_role:
        name: argocd_install
      when: argocd_install | bool
    - name: Set up htpass identity manager
      include_role:
        name: htpass_idm
      when: htpass_idm | bool
    - name: Install Cert Manager
      include_role:
        name: certmanager_install
      when: certmanager_install | bool
    - name: Bootstrap cert manager CA
      include_role:
        name: bootstrap_cert_manager
      when: bootstrap_cert_manager | bool
    - name: Deploy bgd application
      include_role:
        name: bgd_app
      when: bgd_app | bool
...
